<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>å¥³å·«çš„æ¯’è¯ Â· åŒäººå¯¹æˆ˜</title>
<style>
  body { font-family: sans-serif; text-align: center; }
  .grid {
    display: grid;
    grid-template-columns: repeat(5, 60px);
    gap: 6px;
    justify-content: center;
    margin-top: 20px;
  }
  .cell {
    width: 60px;
    height: 60px;
    border: 1px solid #333;
    font-size: 22px;
    cursor: pointer;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .disabled { pointer-events: none; opacity: 0.4; }
</style>
</head>
<body>

<h2>ğŸ§™ å¥³å·«çš„æ¯’è¯ï¼ˆåŒäººåœ¨çº¿ï¼‰</h2>
<p id="status">è¿æ¥ä¸­...</p>

<div class="grid" id="grid"></div>

<script>
const ws = new WebSocket("ws://localhost:8080");
let myId = null;
let myTurn = false;
let poisonChosen = false;

const grid = document.getElementById("grid");
const status = document.getElementById("status");

for (let i = 0; i < 25; i++) {
  const d = document.createElement("div");
  d.className = "cell";
  d.textContent = i;
  d.onclick = () => clickCell(i, d);
  grid.appendChild(d);
}

ws.onmessage = e => {
  const data = JSON.parse(e.data);

  if (data.type === "init") {
    myId = data.id;
    status.textContent = "è¯·é€‰æ‹©ä½ çš„æ¯’è¯";
  }

  if (data.type === "start") {
    myTurn = data.turn === myId;
    status.textContent = myTurn ? "ä½ çš„å›åˆ" : "å¯¹æ–¹å›åˆ";
  }

  if (data.type === "move") {
    myTurn = data.turn === myId;
    status.textContent = myTurn ? "ä½ çš„å›åˆ" : "å¯¹æ–¹å›åˆ";
  }

  if (data.type === "end") {
    alert(data.loser === myId ? "ğŸ’€ ä½ è¾“äº†" : "ğŸ‰ ä½ èµ¢äº†");
    location.reload();
  }
};

function clickCell(index, el) {
  if (!poisonChosen) {
    poisonChosen = true;
    el.textContent = "â˜ ";
    ws.send(JSON.stringify({ type: "poison", index }));
    status.textContent = "ç­‰å¾…å¯¹æ–¹é€‰æ‹©æ¯’è¯...";
    return;
  }

  if (!myTurn) return;

  ws.send(JSON.stringify({ type: "select", index }));
}
</script>
</body>
</html>
